<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vongdefu.github.io/04-middleware/redis/ch01-redisobj.html"><meta property="og:site_name" content="cs-tips"><meta property="og:title" content="对象系统"><meta property="og:description" content="Redis 使用对象来表示每一个键值对，在 Redis 中创建的每一个键值对，Redis 都会为我们创建至少两个 RedisObject 对象： 键对象，即 key ；键对象的数据结构为字符串；; 值对象，即 value ；而值对象因其保存的数据内容不一样，因而其使用的数据结构也不一样。; 事实上，数据库中的每个键、值，以及 Redis 本身处理的参数..."><meta property="og:type" content="article"><meta property="og:image" content="https://vongdefu.github.io/"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="对象系统"><meta property="article:author" content="vongdefu"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"对象系统","image":["https://vongdefu.github.io/"],"dateModified":null,"author":[{"@type":"Person","name":"vongdefu","url":"https://github.com/vongdefu"}]}</script><link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>对象系统 | cs-tips</title><meta name="description" content="Redis 使用对象来表示每一个键值对，在 Redis 中创建的每一个键值对，Redis 都会为我们创建至少两个 RedisObject 对象： 键对象，即 key ；键对象的数据结构为字符串；; 值对象，即 value ；而值对象因其保存的数据内容不一样，因而其使用的数据结构也不一样。; 事实上，数据库中的每个键、值，以及 Redis 本身处理的参数...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-8909e15b.css" as="style"><link rel="stylesheet" href="/assets/style-8909e15b.css">
    <link rel="modulepreload" href="/assets/app-fb6938a2.js"><link rel="modulepreload" href="/assets/framework-16b96b76.js"><link rel="modulepreload" href="/assets/ch01-redisobj.html-925a6e6f.js"><link rel="modulepreload" href="/assets/ch01-redisobj.html-84325b76.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="cs-tips"><!----><span class="site-name hide-in-pad">cs-tips</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="font-icon icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/01-csbase" class="nav-link" aria-label="要点提示"><span class="font-icon icon iconfont icon-ability" style=""></span>要点提示<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://github.com/vongdefu/vongdefu.github.io/issues" rel="noopener noreferrer" target="_blank" aria-label="问题反馈" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>问题反馈<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vongdefu/vongdefu.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!----><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">搜索</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">面渣</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-computer" style=""></span><span class="title">01-CS基础</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="title">02-Java编程语言</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-layout" style=""></span><span class="title">03-框架</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-api" style=""></span><span class="title">04-中间件</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/04-middleware/es.html" class="nav-link sidebar-link sidebar-page" aria-label="搜索引擎知识点汇总"><!---->搜索引擎知识点汇总<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/mq.html" class="nav-link sidebar-link sidebar-page" aria-label="消息队列知识点汇总"><!---->消息队列知识点汇总<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/mysql.html" class="nav-link sidebar-link sidebar-page" aria-label="MySQL"><!---->MySQL<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/nginx.html" class="nav-link sidebar-link sidebar-page" aria-label="nginx"><!---->nginx<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><!----><a href="/04-middleware/redis/" class="title">Redis</a><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="对象系统"><!---->对象系统<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#为什么要有对象系统" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="为什么要有对象系统"><!---->为什么要有对象系统<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#源代码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="源代码"><!---->源代码<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#type-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="type 属性"><!---->type 属性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#encoding-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="encoding 属性"><!---->encoding 属性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#lru-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="lru 属性"><!---->lru 属性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#refcount-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="refcount 属性"><!---->refcount 属性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#ptr-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ptr 属性"><!---->ptr 属性<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#一个对象在内存中的存储示意" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="一个对象在内存中的存储示意"><!---->一个对象在内存中的存储示意<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#内建对象" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="内建对象"><!---->内建对象<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#命令的类型检查和多态" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="命令的类型检查和多态"><!---->命令的类型检查和多态<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="总结"><!---->总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/04-middleware/redis/ch02-datatype.html" class="nav-link sidebar-link sidebar-page" aria-label="数据类型"><!---->数据类型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/redis/ch03-greatfeature.html" class="nav-link sidebar-link sidebar-page" aria-label="3. 高级特性"><!---->3. 高级特性<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/redis/ch04-memorymanage.html" class="nav-link sidebar-link sidebar-page" aria-label="4. 内存管理"><!---->4. 内存管理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/redis/ch05-durationtodisk.html" class="nav-link sidebar-link sidebar-page" aria-label="5. 持久化机制"><!---->5. 持久化机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/redis/ch06-running-mode.html" class="nav-link sidebar-link sidebar-page" aria-label="6. 运行模式"><!---->6. 运行模式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/redis/ch07-product-devops.html" class="nav-link sidebar-link sidebar-page" aria-label="7. 生产运维"><!---->7. 生产运维<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/redis/ch08-best-pratice.html" class="nav-link sidebar-link sidebar-page" aria-label="8. 生产实践"><!---->8. 生产实践<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/redis/ch09-appendix01-local-distribute-cache-pratice.html" class="nav-link sidebar-link sidebar-page" aria-label="附录 01 本地缓存与分布式缓存示例"><!---->附录 01 本地缓存与分布式缓存示例<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/04-middleware/redis/ch09-appendix02-benchmark.html" class="nav-link sidebar-link sidebar-page" aria-label="附录 02 基准测试示例"><!---->附录 02 基准测试示例<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-structure" style=""></span><span class="title">05-分布式</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-like" style=""></span><span class="title">06-软件质量管理</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-editor" style=""></span><span class="title">07-工程设计</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->对象系统</h1><!----><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#为什么要有对象系统" class="router-link-active router-link-exact-active toc-link level2">为什么要有对象系统</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#源代码" class="router-link-active router-link-exact-active toc-link level2">源代码</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#type-属性" class="router-link-active router-link-exact-active toc-link level3">type 属性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#encoding-属性" class="router-link-active router-link-exact-active toc-link level3">encoding 属性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#lru-属性" class="router-link-active router-link-exact-active toc-link level3">lru 属性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#refcount-属性" class="router-link-active router-link-exact-active toc-link level3">refcount 属性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#ptr-属性" class="router-link-active router-link-exact-active toc-link level3">ptr 属性</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#一个对象在内存中的存储示意" class="router-link-active router-link-exact-active toc-link level2">一个对象在内存中的存储示意</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#内建对象" class="router-link-active router-link-exact-active toc-link level2">内建对象</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#命令的类型检查和多态" class="router-link-active router-link-exact-active toc-link level3">命令的类型检查和多态</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/04-middleware/redis/ch01-redisobj.html#总结" class="router-link-active router-link-exact-active toc-link level2">总结</a></li><!----><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="对象系统" tabindex="-1"><a class="header-anchor" href="#对象系统" aria-hidden="true">#</a> 对象系统</h1><p>Redis 使用对象来表示每一个键值对，在 Redis 中创建的每一个键值对，Redis 都会为我们创建至少两个 RedisObject 对象：</p><ul><li><strong>键对象，即 key</strong> ；键对象的数据结构为字符串；</li><li><strong>值对象，即 value</strong> ；而值对象因其保存的数据内容不一样，因而其使用的数据结构也不一样。</li></ul><p>事实上，数据库中的每个键、值，以及 Redis 本身处理的参数, 都表示为这种数据类型。</p><blockquote><p>这里，我们介绍一下 Redis <code>值对象</code>所支持的数据类型。所谓 <code>值对象</code>所支持的数据类型，是从业务角度来讲的，如 String，是指使用 Redis 的业务，需要保存到 Redis 中的数据的类型为 String，而不是指别的其他。同理 List，是指使用 Redis 的业务场景中，保存到 Redis 的数据的数据类型是 List，也不是指其他。</p><p>说白了，<code>键对象</code>就是一个字符串，相当于对保存的值起了个名字。</p><p>读者要对这一点很清楚。</p></blockquote><p>3.2 版本是一个重要的稳定版本，有很多的更新，详见<a href="http://antirez.com/news/104" target="_blank" rel="noopener noreferrer">这里<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h2 id="为什么要有对象系统" tabindex="-1"><a class="header-anchor" href="#为什么要有对象系统" aria-hidden="true">#</a> 为什么要有对象系统</h2><ol><li>有些命令要求只能用于某种特定类型的键，而有些命令则可以作用到所有类型的键，这就需要构建一种可以识别键的类型的机制，让命令执行时通过判断键的类型来选择合适的处理方式；</li><li>Redis 是内存数据库，为了节省内存资源，Redis 设计了多种数据类型，而某些命令作用于其中某种类型的数据时，并不需要关注其底层到底使用的是那种数据结构，因此，还需要建立一种能够识别值的数据类型的机制，让命令执行时能够自行判断到底应该用到哪种数据结构上；</li></ol><p>因此，redis 设计了自己的类型系统——redisObject 对象。</p><p>主要有两点原因：</p><ol><li>为了更好的管理 redis 中的数据；</li><li>为了适应命令的多态；</li></ol><h2 id="源代码" tabindex="-1"><a class="header-anchor" href="#源代码" aria-hidden="true">#</a> 源代码</h2><figure><img src="/assets/1718577572091-de402671.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span> <span class="token punctuation">{</span>

    <span class="token comment">// 类型，标识该对象是什么类型的对象（String 对象、 List 对象、Hash 对象、Set 对象和 Zset 对象）；</span>
    <span class="token keyword">unsigned</span> type<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token comment">// 编码方式</span>
    <span class="token keyword">unsigned</span> encoding<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token comment">// LRU - 24位, 记录最末一次访问时间（相对于lru_clock）; 或者 LFU（最少使用的数据：8位频率，16位访问时间）</span>
    <span class="token keyword">unsigned</span> lru<span class="token operator">:</span>LRU_BITS<span class="token punctuation">;</span> <span class="token comment">/* LRU time (relative to global lru_clock) or
                            * LFU data (least significant 8 bits frequency   LFU： Least Frequently Used， 最不频繁使用
                            * and most significant 16 bits access time). */</span>

    <span class="token comment">// 引用计数</span>
    <span class="token keyword">int</span> refcount<span class="token punctuation">;</span>

    <span class="token comment">// 指向底层数据结构实例</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>
<span class="token punctuation">}</span> robj<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="data:image/png;base64,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" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="data:image/png;base64,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" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="type-属性" tabindex="-1"><a class="header-anchor" href="#type-属性" aria-hidden="true">#</a> type 属性</h3><p>可以使用 <code>type</code> 命令获取，记录了对象 <code>所保存的值的类型</code>。</p><blockquote><p>type [key]</p></blockquote><p>其枚举值如下：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* A redis object, that is a type able to hold a string / list / set */</span>

<span class="token comment">/* The actual Redis Object */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_STRING</span> <span class="token expression"><span class="token number">0</span>    </span><span class="token comment">/* String object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_LIST</span> <span class="token expression"><span class="token number">1</span>      </span><span class="token comment">/* List object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_SET</span> <span class="token expression"><span class="token number">2</span>       </span><span class="token comment">/* Set object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ZSET</span> <span class="token expression"><span class="token number">3</span>      </span><span class="token comment">/* Sorted set object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_HASH</span> <span class="token expression"><span class="token number">4</span>      </span><span class="token comment">/* Hash object. */</span></span>

<span class="token comment">/* The &quot;module&quot; object type is a special one that signals that the object
 * is one directly managed by a Redis module. In this case the value points
 * to a moduleValue struct, which contains the object value (which is only
 * handled by the module itself) and the RedisModuleType struct which lists
 * function pointers in order to serialize, deserialize, AOF-rewrite and
 * free the object.
 *
 * Inside the RDB file, module types are encoded as OBJ_MODULE followed
 * by a 64 bit module type ID, which has a 54 bits module-specific signature
 * in order to dispatch the loading to the right module, plus a 10 bits
 * encoding version. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_MODULE</span> <span class="token expression"><span class="token number">5</span>    </span><span class="token comment">/* Module object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_STREAM</span> <span class="token expression"><span class="token number">6</span>    </span><span class="token comment">/* Stream object. */</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="encoding-属性" tabindex="-1"><a class="header-anchor" href="#encoding-属性" aria-hidden="true">#</a> encoding 属性</h3><p>可以使用 <code>object encoding</code> 命令获取，记录了对象 <code>所保存的值的编码</code>。</p><blockquote><p>object encoding [key]</p></blockquote><p>其枚举值如下：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* Objects encoding. Some kind of objects like Strings and Hashes can be
 * internally represented in multiple ways. The &#39;encoding&#39; field of the object
 * is set to one of this fields for this object. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_RAW</span> <span class="token expression"><span class="token number">0</span>     </span><span class="token comment">/* Raw representation */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_INT</span> <span class="token expression"><span class="token number">1</span>     </span><span class="token comment">/* Encoded as integer */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_HT</span> <span class="token expression"><span class="token number">2</span>      </span><span class="token comment">/* Encoded as hash table */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_ZIPMAP</span> <span class="token expression"><span class="token number">3</span>  </span><span class="token comment">/* Encoded as zipmap */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_LINKEDLIST</span> <span class="token expression"><span class="token number">4</span> </span><span class="token comment">/* No longer used: old list encoding. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_ZIPLIST</span> <span class="token expression"><span class="token number">5</span> </span><span class="token comment">/* Encoded as ziplist */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_INTSET</span> <span class="token expression"><span class="token number">6</span>  </span><span class="token comment">/* Encoded as intset */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_SKIPLIST</span> <span class="token expression"><span class="token number">7</span>  </span><span class="token comment">/* Encoded as skiplist */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_EMBSTR</span> <span class="token expression"><span class="token number">8</span>  </span><span class="token comment">/* Embedded sds string encoding */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_QUICKLIST</span> <span class="token expression"><span class="token number">9</span> </span><span class="token comment">/* Encoded as linked list of ziplists */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_STREAM</span> <span class="token expression"><span class="token number">10</span> </span><span class="token comment">/* Encoded as a radix tree of listpacks */</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 object encoding 命令输出的结果有： raw、int、embstr、hashtable、quicklist、ziplist、intset、skiplist 等， OBJ_ENCODING_XXX 为代码中使用，它与输出结果的转化代码如下：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strEncoding</span><span class="token punctuation">(</span><span class="token keyword">int</span> encoding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> OBJ_ENCODING_RAW<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;raw&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_INT<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;int&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_HT<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;hashtable&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_QUICKLIST<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;quicklist&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_ZIPLIST<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;ziplist&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_INTSET<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;intset&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_SKIPLIST<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;skiplist&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_EMBSTR<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;embstr&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis objects can be encoded in different ways:</p><ul><li>Strings can be encoded as: <ul><li><strong>raw</strong>, normal string encoding.</li><li><strong>int</strong>, strings representing integers in a 64-bit signed interval, encoded in this way to save space.</li><li><strong>embstr</strong>, an embedded string, which is an object where the internal simple dynamic string, <strong>sds</strong>, is an unmodifiable string allocated in the same chuck as the object itself. <strong>embstr</strong> can be strings with lengths up to the hardcoded limit of <strong>OBJ_ENCODING_EMBSTR_SIZE_LIMIT</strong> or 44 bytes.</li></ul></li><li>Lists can be encoded as: <ul><li><strong>linkedlist</strong>, simple list encoding. No longer used, an old list encoding.</li><li><strong>ziplist</strong>, Redis &lt;= 6.2, a space-efficient encoding used for small lists.</li><li><strong>listpack</strong>, Redis &gt;= 7.0, a space-efficient encoding used for small lists.</li><li><strong>quicklist</strong>, encoded as linkedlist of ziplists or listpacks.</li></ul></li><li>Sets can be encoded as: <ul><li><strong>hashtable</strong>, normal set encoding.</li><li><strong>intset</strong>, a special encoding used for small sets composed solely of integers.</li><li><strong>listpack</strong>, Redis &gt;= 7.2, a space-efficient encoding used for small sets.</li></ul></li><li>Hashes can be encoded as: <ul><li><strong>zipmap</strong>, no longer used, an old hash encoding.</li><li><strong>hashtable</strong>, normal hash encoding.</li><li><strong>ziplist</strong>, Redis &lt;= 6.2, a space-efficient encoding used for small hashes.</li><li><strong>listpack</strong>, Redis &gt;= 7.0, a space-efficient encoding used for small hashes.</li></ul></li><li>Sorted Sets can be encoded as: <ul><li><strong>skiplist</strong>, normal sorted set encoding.</li><li><strong>ziplist</strong>, Redis &lt;= 6.2, a space-efficient encoding used for small sorted sets.</li><li><strong>listpack</strong>, Redis &gt;= 7.0, a space-efficient encoding used for small sorted sets.</li></ul></li><li>Streams can be encoded as: <ul><li><strong>stream</strong>, encoded as a radix tree of listpacks.</li></ul></li></ul><p>All the specially encoded types are automatically converted to the general type once you perform an operation that makes it impossible for Redis to retain the space saving encoding.</p><p>Returns the string representation of the type of the value stored at <strong>key</strong>. The different types that can be returned are: <strong>string</strong>, <strong>list</strong>, <strong>set</strong>, <strong>zset</strong>, <strong>hash</strong> and <strong>stream</strong>.</p><h3 id="lru-属性" tabindex="-1"><a class="header-anchor" href="#lru-属性" aria-hidden="true">#</a> lru 属性</h3><p><strong>lru 属性</strong>: 记录了对象最后一次被命令程序访问的时间 <strong>空转时长</strong>：当前时间减去键的值对象的 lru 时间，就是该键的空转时长。Object idletime 命令可以打印出给定键的空转时长 如果服务器打开了 maxmemory 选项，并且服务器用于回收内存的算法为 volatile-lru 或者 allkeys-lru，那么当服务器占用的内存数超过了 maxmemory 选项所设置的上限值时，空转时长较高的那部分键会优先被服务器释放，从而回收内存</p><h3 id="refcount-属性" tabindex="-1"><a class="header-anchor" href="#refcount-属性" aria-hidden="true">#</a> refcount 属性</h3><p><strong>refcount 属性</strong>：关系着对象引用计数以及对象的消毁 redisObject 中有 refcount 属性，是对象的引用计数，计数为 0 时就可以回收。</p><ul><li>每个 redisObject 结构都带有一个 refcount 属性，指示这个对象被引用了多少次；</li><li>当新创建一个对象时，它的 refcount 属性被设置为 1；</li><li>当对一个对象进行共享时，redis 将这个对象的 refcount 加一；</li><li>当使用完一个对象后，或者消除对一个对象的引用之后，程序将对象的 refcount 减一；</li><li>当对象的 refcount 降至 0 时，这个 RedisObject 结构，以及它引用的数据结构的内存都会被释放。</li></ul><h3 id="ptr-属性" tabindex="-1"><a class="header-anchor" href="#ptr-属性" aria-hidden="true">#</a> ptr 属性</h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> TODO</label></li></ul><h2 id="一个对象在内存中的存储示意" tabindex="-1"><a class="header-anchor" href="#一个对象在内存中的存储示意" aria-hidden="true">#</a> 一个对象在内存中的存储示意</h2><figure><img src="/assets/1716343090690-0a6a4bcc.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> str1 abcdefghijklmnopqrstuvwxyz1234
<span class="token punctuation">[</span>@sjs_73_171 WEB-INF<span class="token punctuation">]</span>$ redis-memory-for-key <span class="token parameter variable">-s</span> b.redis <span class="token parameter variable">-p</span> <span class="token number">1959</span> str1
Key                             str1
Bytes                           <span class="token number">80</span>
Type                            string

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出 str1 在内存中所占的大小为： 80 字节。</p><blockquote><p>参考： <a href="https://www.cnblogs.com/wangcp-2014/p/15702410.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/wangcp-2014/p/15702410.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h2 id="内建对象" tabindex="-1"><a class="header-anchor" href="#内建对象" aria-hidden="true">#</a> 内建对象</h2><p>redis 一般会把一些常见的值放到一个共享对象中，这样可使程序避免了重复分配的麻烦，也节约了一些 CPU 时间。</p><p>redis 预分配的值对象如下：</p><ul><li>各种命令的返回枚举值，比如成功时返回的 OK，错误时返回的 ERROR，命令入队事务时返回的 QUEUE，等等</li><li>包括 0 在内，小于 REDIS_SHARED_INTEGERS 的所有整数（REDIS_SHARED_INTEGERS 的默认值是 10000）</li></ul><p>为什么 redis 不共享列表对象、哈希对象、集合对象、有序集合对象，只共享字符串对象？</p><ul><li>列表对象、哈希对象、集合对象、有序集合对象，本身可以包含字符串对象，复杂度较高。</li><li>如果共享对象是保存字符串对象，那么验证操作的复杂度为 O(1)</li><li>如果共享对象是保存字符串值的字符串对象，那么验证操作的复杂度为 O(N)</li><li>如果共享对象是包含多个值的对象，其中值本身又是字符串对象，即其它对象中嵌套了字符串对象，比如列表对象、哈希对象，那么验证操作的复杂度将会是 O(N 的平方)</li></ul><p>如果对复杂度较高的对象创建共享对象，需要消耗很大的 CPU，用这种消耗去换取内存空间，是不合适的</p><h3 id="命令的类型检查和多态" tabindex="-1"><a class="header-anchor" href="#命令的类型检查和多态" aria-hidden="true">#</a> 命令的类型检查和多态</h3><p><strong>当执行一个处理数据类型命令的时候，redis 执行以下步骤</strong></p><ul><li>根据给定的 key，在数据库字典中查找和他相对应的 redisObject，如果没找到，就返回 NULL；</li><li>检查 redisObject 的 type 属性和执行命令所需的类型是否相符，如果不相符，返回类型错误；</li><li>根据 redisObject 的 encoding 属性所指定的编码，选择合适的操作函数来处理底层的数据结构；</li><li>返回数据结构的操作结果作为命令的返回值。</li></ul><figure><img src="/assets/1726156365855-8c0a38a7.png" alt="1726156365855" tabindex="0" loading="lazy"><figcaption>1726156365855</figcaption></figure><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><ul><li>redis 使用自己实现的对象机制（redisObject)来实现类型判断、命令多态和基于引用次数的垃圾回收；</li><li>redis 会预分配一些常用的数据对象，并通过共享这些对象来减少内存占用，和避免频繁的为小对象分配内存</li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vongdefu/vongdefu.github.io/edit/main/demo/theme-docs/src/04-middleware/redis/ch01-redisobj.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><nav class="page-nav"><!----><a href="/04-middleware/redis/ch02-datatype.html" class="nav-link next" aria-label="数据类型"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">数据类型<!----></div></a></nav><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">浪漫骑士的二流键盘</div><div class="copyright">Copyright © 2025 vongdefu</div></footer></div><!--]--><!----><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-fb6938a2.js" defer></script>
  </body>
</html>
