import{_ as a,W as e,X as t,Y as n,Z as p,$ as l,a0 as c,C as i}from"./framework-16b96b76.js";const o="/assets/1719395107653-d87313a1.png",u="/assets/1719395007430-6ed1f629.png",r="/assets/1726162366235-25569d04.png",d="/assets/1726162400771-6871a505.png",b={},m=c('<h1 id="_6-运行模式" tabindex="-1"><a class="header-anchor" href="#_6-运行模式" aria-hidden="true">#</a> 6. 运行模式</h1><h3 id="_6-1-单机模式" tabindex="-1"><a class="header-anchor" href="#_6-1-单机模式" aria-hidden="true">#</a> 6.1. 单机模式</h3><h4 id="_6-1-1-安装过程" tabindex="-1"><a class="header-anchor" href="#_6-1-1-安装过程" aria-hidden="true">#</a> 6.1.1. 安装过程</h4><ol><li>安装 gcc 编译工具等；</li><li>下载源代码；</li><li>make &amp; make install</li><li>redis-server redis.conf</li></ol><p>事件机制 IO 模型</p><h3 id="_6-2-主从模式" tabindex="-1"><a class="header-anchor" href="#_6-2-主从模式" aria-hidden="true">#</a> 6.2. 主从模式</h3><h4 id="_6-2-1-安装" tabindex="-1"><a class="header-anchor" href="#_6-2-1-安装" aria-hidden="true">#</a> 6.2.1. 安装</h4><ul><li>部署视图</li></ul><figure><img src="'+o+'" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ol><li>主从结构下，一般也是读写分离的模式，即主节点负责数据的写入和读取，从节点负责数据的读取；当然也可以让从节点也支持写入操作，可以在配置文件中进行设置 <code>slave-read-only yes|no</code>；</li><li>部署模型大概有两种**： 星状拓扑<strong>和</strong>树状拓扑**。即所有的从节点都从一个主节点上复制数据，和只有部分从节点从主节点复制数据，其余从节点再从已经同步完成的从节点复制数据。树状拓扑解决了主节点的复制压力，因为所有从节点从主节点复制时，都会把RDB文件赋值给从节点，从节点一多，主节点的压力可想而知。</li><li>主从结构下的数据复制分为两种**： 全量复制<strong>和</strong>增量复制** 当第一次复制时，采用是全量复制的方式； 之后采用的是增量复制的方式； 为了解决生成RDB文件时耗时过多，redis还提供了无盘复制的方式，即不生成RDB文件，在内存缓冲区就把数据通过socket发送给从节点了，从配置文件中得知，这种方式目前还处于实验阶段，可以通过repl-diskless-sync 设置成yes或no的方式配置，但是默认值是 no，即不开启<strong>无盘赋值</strong>方式；</li></ol><p>全量复制的过程：</p><ol><li>从节点执行psync命令发送给主节点；</li><li>主节点把主节点的实例id和复制进度标识响应给从节点，之后主节点开始执行bgsave命令，生成RDB文件；</li><li>主节点把生成好的RDB文件发送给从节点；</li><li>从节点接收到RDB文件之后，进行数据恢复； 【注意：从节点加载 RDB 文件期间是不能对外提供服务的】</li></ol><p>使用RDB而不是AOF的原因： RDB比AOF恢复起来快。</p><p>增量复制的出现是因为两点：</p><ol><li>主节点生成RDB文件以及传输RDB文件的过程中，并不会停止对外服务，也就是说主节点还有可能会有数据写入；这部分新写入的数据就是增量数据；</li><li>从节点完成首次全量同步后，可能会出现网络问题，导致主从失去联系，在从节点失联阶段，主节点也有可能会有数据写入；这部分新写入的数据也是增量数据；</li></ol><p>解决增量数据的同步问题： 主节点在执行bgsave命令生成RDB文件时，也会在内存中生成一个缓冲区，这个缓冲区就记录之后的新的写命令；事实上这个缓冲区是一个环形缓冲区，上面除了保存新的写入命令外，还保存着主从节点的复制标识位；这样两个复制标识位中间的写命令就是需要增量同步的内容。这个缓冲区的大小可以通过repl-backlog-size进行设置，默认是1MB。 但这种环形命令缓冲区还是有问题，如，主节点的复制标识位追上从节点的复制标识位了，那就需要增加这个环形缓冲区的大小；但是加多少依然是个问题，只能通过集群来解决。</p><p>主从复制下的问题：</p><ol><li><strong>主从数据不一致问题不可避免</strong>。虽然可以通过优化网络、升级硬件资源等手段改进，但依旧不可避免。主从不一致严重时，可以通过让从节点拒绝服务，配置参数为： slave-serve-stale-data yes|no ;</li><li><strong>键的过期问题</strong>。3.2之前客户端很容易从从节点读到过期的数据，3.2之后在读数据时，从节点会先判断过期时间，解决了这个问题；</li><li><strong>主从切换问题</strong>。并没有解决主从角色切换问题，只能通过客户端手动切换。</li></ol><p>最佳实践：</p><ol><li>优化从节点的角色，比如减少慢查询、不进行持久化等；再比如，把一部分从节点设置为只对外提供读写能力，一部分从节点只提供备份功能等；</li><li>使用哨兵模式配合主从模式，提高整体可用性，减少对应用的侵入；</li></ol><p>在主从复制期间，从节点与主节点突然断开连接，会出现什么情况？【主从不一致，增量数据通过环形缓冲区记录下来，等到从节点再次重连后，主节点会把环形缓冲区的写命令重新发送给从节点】 当主节点挂掉后会出现什么情况？【停止对外服务】</p><h3 id="_6-3-哨兵模式" tabindex="-1"><a class="header-anchor" href="#_6-3-哨兵模式" aria-hidden="true">#</a> 6.3. 哨兵模式</h3><figure><img src="'+u+`" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>主要目的： 解决主从架构的遗留问题，主要还是用来搞定高可用的需求。 主从架构中没有解决节点异常后无法对外提供服务的问题。</p><p>具体一点有以下几个功能点：</p><ol><li>监控：监控所配置的主从集群中的节点健康状况；</li><li>故障转移：当主从节点出现异常时会自动化切换主从点的角色，以保证整个集群的正常运行；</li><li>配置：简单主从架构在使用时，要在客户端配置所有的节点信息，用了哨兵模式之后，只需要配置哨兵的连接信息即可；</li><li>通知： 主从节点出现异常时，哨兵负责把异常信息和故障转移后的新信息传给通知到客户端。</li></ol><p>哨兵组网</p><p>sentinel monitor <code>&lt;master-name&gt;</code> <code>&lt;ip&gt;</code> <code>&lt;redis-port&gt;</code> <code>&lt;quorum&gt;</code> 在哨兵的安装的过程中，每个节点中的配置文件中都有一项：sentinel monitor mymaster 192.168.14.101 6379 2 这一配置项表明每个哨兵都启动时都要先与主节点进行通信。</p><p>事实上，主从结构部署完成之后，主节点会会初始化一个 <strong>sentinel</strong>:hello 的频道，当哨兵接入主从架构后，哨兵会把自身的连接信息发布到这个频道上，并从这个频道上读取其它的哨兵信息。</p><p>总结： 哨兵集群是通过主节点上，名为 <strong>sentinel</strong>:hello 的频道的发布订阅机制完成各个哨兵节点的信息交互的。</p><p>主要作用是配合主从架构使用，主要用来保证高可用性，但是还包括其它特性，比如监控、故障转移、配置中心、消息通知等。</p><p>在主从模式中，并没有解决主节点异常而导致的无法对外提供服务时，主从节点切换问题。 主要用来无人值守运维，保证高可用，主要用于主从切换，提高可用性。</p><ul><li><p>其它特性？【监控、故障转移、配置中心、消息通知】</p></li><li><p>部署模型（3+3）</p></li><li><p>原理</p><ul><li>哨兵组网</li><li>监控主库下线【客观下线、主观下线】</li><li>故障转移（选出主库）【选出兵王、选出主库、通知客户端、主库再次上线】</li></ul></li><li><p>最佳实践</p></li></ul><ol><li>哨兵模式的部署视图大概是怎样的？</li><li>哨兵模式有什么作用？</li><li>当节点出现异常时，会出现什么情况？ <ol><li>要分节点角色到底是哨兵节点还是数据节点？</li></ol></li></ol><p>问题是哨兵也可以监控多个主数据节点，这也是数据节点的集群啊？为什么还需要cluster这种集群解决方案呢？ cluster有分片/槽算法，把请求尽量平均的负载均衡到各个机器。</p><h3 id="_6-4-集群模式" tabindex="-1"><a class="header-anchor" href="#_6-4-集群模式" aria-hidden="true">#</a> 6.4. 集群模式</h3><p>三种运行模式的对比</p><ul><li>主从模式主要解决单机模式下无法实现读写分离的问题；</li><li>哨兵模式主要解决主从模式下无法实现故障快速恢复的问题，也可以理解为哨兵模式主要解决了主从模式下的高可用问题；</li><li>集群模式主要解决了哨兵模式下无法实现负载均衡的问题，有些说法是集群模式解决了哨兵模式的高可扩的问题，事实上这种说法是不严谨的，因为哨兵模式事实上也是可以完成高可扩的，只需要配置多个 <code>sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</code>即可。哨兵模式的问题在于它监控的每一个主从集群的数据分布不均匀，并且还依赖于使用这种运行模式的 smartClient，而集群模式则解决了哨兵模式下的这两个问题。</li></ul><hr><h2 id="单机模式" tabindex="-1"><a class="header-anchor" href="#单机模式" aria-hidden="true">#</a> 单机模式</h2><h2 id="主从模式" tabindex="-1"><a class="header-anchor" href="#主从模式" aria-hidden="true">#</a> 主从模式</h2><p>三主三从。</p><ol><li>分别在三台主机上安装三个单机版 redis。</li><li></li></ol><h2 id="哨兵模式" tabindex="-1"><a class="header-anchor" href="#哨兵模式" aria-hidden="true">#</a> 哨兵模式</h2><ol><li>安装过程</li><li>哨兵节点异常示例</li></ol><h2 id="集群模式" tabindex="-1"><a class="header-anchor" href="#集群模式" aria-hidden="true">#</a> 集群模式</h2><ol><li>安装过程</li><li>增加节点</li><li>减少节点</li><li>客户端使用 redis 集群示例</li><li>故障转移示例</li></ol><h4 id="安装过程" tabindex="-1"><a class="header-anchor" href="#安装过程" aria-hidden="true">#</a> 安装过程</h4><ol><li>部署模型：3主3从</li><li>资源分配：安装到同一台主机上，端口分别为： 主（30001-30003），从（30004-30006）</li><li>安装过程</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#配置端口
port \${port}
#以守护进程模式启动
daemonize yes
#pid的存放文件
pidfile /var/run/redis_\${port}.pid
#日志文件名
logfile &quot;redis_\${port}.log&quot;
#存放备份文件以及日志等文件的目录
dir &quot;/opt/redis/data&quot;  
#rdb备份文件名
dbfilename &quot;dump_\${port}.rdb&quot;
#开启集群功能
cluster-enabled yes
#集群配置文件，节点自动维护
cluster-config-file nodes-\${port}.conf
#集群能够运行不需要集群中所有节点都是成功的
cluster-require-full-coverage no

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动六个节点：配置完成后，通过 <strong>./redis-server redis.conf</strong> 命令依次启动这六个节点。</li><li>创建集群：输入命令 ./redis-cli --cluster create 127.0.0.1:30001 127.0.0.1:30002 127.0.0.1:30003 127.0.0.1:30004 127.0.0.1:30005 127.0.0.1:30006 --cluster-replicas 1</li></ul><p>①、\${password} 表示连接Redis的密码，通常整个集群我们要么不设置密码，要么设置成一样的。 　　②、后面的六个ip:port，按照顺序，前面三个是主节点，后面三个是从节点，顺序不能错。 　　③、最后数字 1 表示一个主节点只有一个从节点。和前面的配置相对应。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">127.0</span>.0.1:30005 to <span class="token number">127.0</span>.0.1:30001
Adding replica <span class="token number">127.0</span>.0.1:30006 to <span class="token number">127.0</span>.0.1:30002
Adding replica <span class="token number">127.0</span>.0.1:30004 to <span class="token number">127.0</span>.0.1:30003
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Trying to optimize slaves allocation <span class="token keyword">for</span> anti-affinity
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Some slaves are <span class="token keyword">in</span> the same <span class="token function">host</span> as their master
M: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
M: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
M: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30004
   replicates bdd1c913f87eacbdfeabc71befd0d06c913c891c
S: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30005
   replicates bdd1c913f87eacbdfeabc71befd0d06c913c891c
S: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30006
   replicates bdd1c913f87eacbdfeabc71befd0d06c913c891c
Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">&#39;yes&#39;</span> to accept<span class="token punctuation">)</span>:  <span class="token function">yes</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each <span class="token function">node</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">127.0</span>.0.1:30001<span class="token punctuation">)</span>
M: 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 887397e6fefe8ad19ea7569e99f5eb8a803e3785
S: 1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates f5958382af41d4e1f5b0217c1413fe19f390b55f
S: dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 3da35c40c43b457a113b539259f17e7ed616d13d
M: 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.




</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="查看集群及节点信息" tabindex="-1"><a class="header-anchor" href="#查看集群及节点信息" aria-hidden="true">#</a> 查看集群及节点信息</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ ./redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-p</span> <span class="token number">30001</span> <span class="token comment"># 连接到集群</span>

// 查看集群信息
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster info <span class="token comment"># 查看集群信息</span>
cluster_state:ok <span class="token comment"># 状态正常</span>
cluster_slots_assigned:16384 <span class="token comment"># 槽位数</span>
cluster_slots_ok:16384 <span class="token comment"># 正常的槽位数</span>
cluster_slots_pfail:0 
cluster_slots_fail:0
cluster_known_nodes:6 <span class="token comment"># 集群的节点数</span>
cluster_size:3 <span class="token comment"># 集群主节点数</span>
cluster_current_epoch:6
cluster_my_epoch:1
cluster_stats_messages_ping_sent:130
cluster_stats_messages_pong_sent:127
cluster_stats_messages_sent:257
cluster_stats_messages_ping_received:122
cluster_stats_messages_pong_received:130
cluster_stats_messages_meet_received:5
cluster_stats_messages_received:257

// 查看节点信息
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster nodes
dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006@40006 slave 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">0</span> <span class="token number">1585143789940</span> <span class="token number">6</span> connected
f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003@40003 master - <span class="token number">0</span> <span class="token number">1585143791000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002@40002 master - <span class="token number">0</span> <span class="token number">1585143789000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005@40005 slave 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">0</span> <span class="token number">1585143789000</span> <span class="token number">5</span> connected
887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001@40001 myself,master - <span class="token number">0</span> <span class="token number">1585143786000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004@40004 slave f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">0</span> <span class="token number">1585143791945</span> <span class="token number">4</span> connected



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="部署视图" tabindex="-1"><a class="header-anchor" href="#部署视图" aria-hidden="true">#</a> 部署视图</h4><p>根据上面的安装过程，可以获知<strong>主从节点的对应关系</strong>以及<strong>数据槽的分配情况</strong>：</p><p>| <strong>主节点</strong> | 127.0.0.1:30001 节点ID： <strong>887397e6fefe8ad19ea7569e99f5eb8a803e3785</strong> | 127.0.0.1:30002 节点ID： <strong>3da35c40c43b457a113b539259f17e7ed616d13d</strong> | 127.0.0.1:30003 节点ID： <strong>f5958382af41d4e1f5b0217c1413fe19f390b55f</strong> | | --- | --- | --- | --- | | <strong>数据槽分配情况</strong> | slots:[<strong>0-5460</strong>] (5461 slots) | slots:[<strong>5461-10922</strong>] (5462 slots) | slots:[<strong>10923-16383</strong>] (5461 slots) | | <strong>从节点</strong> | 127.0.0.1:30005 节点ID： <strong>abec9f98f9c01208ba77346959bc35e8e274b6a3</strong> | 127.0.0.1:30006 节点ID： <strong>dc0702625743c48c75ea935c87813c4060547cef</strong> | 127.0.0.1:30004 节点ID： <strong>1a324d828430f61be6eaca7eb2a90728dd5049de</strong> |</p><p>对应的部署视图如下：</p><figure><img src="`+r+`" alt="1726162366235" tabindex="0" loading="lazy"><figcaption>1726162366235</figcaption></figure><h4 id="增加节点" tabindex="-1"><a class="header-anchor" href="#增加节点" aria-hidden="true">#</a> 增加节点</h4><p>把某一节点加入集群有两种方式： cluster meet 和 add-node。</p><ol><li>方式一： 在某一节点上执行 cluster meet {ip}:{port} 命令，如把30007加入集群：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster meet <span class="token number">127.0</span>.0.1 <span class="token number">30007</span>
OK
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster nodes
dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006@40006 slave 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">0</span> <span class="token number">1585142916000</span> <span class="token number">6</span> connected
df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">127.0</span>.0.1:30007@40007 master - <span class="token number">0</span> <span class="token number">1585142917740</span> <span class="token number">0</span> connected
f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003@40003 master - <span class="token number">0</span> <span class="token number">1585142916738</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002@40002 master - <span class="token number">0</span> <span class="token number">1585142913000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005@40005 slave 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">0</span> <span class="token number">1585142917000</span> <span class="token number">5</span> connected
887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001@40001 myself,master - <span class="token number">0</span> <span class="token number">1585142915000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004@40004 slave f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">0</span> <span class="token number">1585142916000</span> <span class="token number">4</span> connected


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出已经把30007设置成了master。</p><ol start="2"><li>方式二：用 redis-cli --cluster add-node 添加节点{ip}:{port} 集群某节点{ip}:{port} 也可以把一个节点添加到集群中。如把30008加入集群：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ redis-cli <span class="token parameter variable">--cluster</span> add-node <span class="token number">127.0</span>.0.1:30008 <span class="token number">127.0</span>.0.1:30001
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Adding <span class="token function">node</span> <span class="token number">127.0</span>.0.1:30008 to cluster <span class="token number">127.0</span>.0.1:30001
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">127.0</span>.0.1:30001<span class="token punctuation">)</span>
M: 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 3da35c40c43b457a113b539259f17e7ed616d13d
M: df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">127.0</span>.0.1:30007
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> master
M: f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 1d09d26fd755298709efe60278457eaa09cefc26 <span class="token number">127.0</span>.0.1:30008
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> master
M: 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 887397e6fefe8ad19ea7569e99f5eb8a803e3785
S: 1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates f5958382af41d4e1f5b0217c1413fe19f390b55f
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
<span class="token punctuation">[</span>ERR<span class="token punctuation">]</span> Node <span class="token number">127.0</span>.0.1:30008 is not empty. Either the <span class="token function">node</span> already knows other nodes <span class="token punctuation">(</span>check with CLUSTER NODES<span class="token punctuation">)</span> or contains some key <span class="token keyword">in</span> database <span class="token number">0</span>.

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出把30008也设置成了master。</p><h4 id="变更节点角色" tabindex="-1"><a class="header-anchor" href="#变更节点角色" aria-hidden="true">#</a> 变更节点角色</h4><p>用 cluster replicate {nodeId} 命令可以把某个主节点变更为另外一个主节点的从节点，例如在30008上执行 cluster replicate {nodeId}命令就可以把30008设置成30007的从节点。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> cluster replicate df0190853a53d8e078205d0e2fa56046f20362a7
OK
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> cluster nodes
df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">127.0</span>.0.1:30007@40007 master - <span class="token number">0</span> <span class="token number">1585147827000</span> <span class="token number">0</span> connected
abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005@40005 slave 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">0</span> <span class="token number">1585147827000</span> <span class="token number">1</span> connected
1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004@40004 slave f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">0</span> <span class="token number">1585147823000</span> <span class="token number">3</span> connected
887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001@40001 master - <span class="token number">0</span> <span class="token number">1585147826000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006@40006 slave 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">0</span> <span class="token number">1585147826930</span> <span class="token number">2</span> connected
f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003@40003 master - <span class="token number">0</span> <span class="token number">1585147826000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
1d09d26fd755298709efe60278457eaa09cefc26 <span class="token number">127.0</span>.0.1:30008@40008 myself,slave df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">0</span> <span class="token number">1585147823000</span> <span class="token number">7</span> connected
3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002@40002 master - <span class="token number">0</span> <span class="token number">1585147827933</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="增加新节点后rehash" tabindex="-1"><a class="header-anchor" href="#增加新节点后rehash" aria-hidden="true">#</a> 增加新节点后rehash</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ redis-cli <span class="token parameter variable">--cluster</span> reshard <span class="token number">127.0</span>.0.1:30007
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">127.0</span>.0.1:30007<span class="token punctuation">)</span>
M: df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">127.0</span>.0.1:30007
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-1332<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">5461</span>-6794<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">10923</span>-12255<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4000</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 3da35c40c43b457a113b539259f17e7ed616d13d
M: 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">6795</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4128</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates f5958382af41d4e1f5b0217c1413fe19f390b55f
S: 1d09d26fd755298709efe60278457eaa09cefc26 <span class="token number">127.0</span>.0.1:30008
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates df0190853a53d8e078205d0e2fa56046f20362a7
S: abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 887397e6fefe8ad19ea7569e99f5eb8a803e3785
M: f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">12256</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4128</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">1333</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4128</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
How many slots <span class="token keyword">do</span> you want to move <span class="token punctuation">(</span>from <span class="token number">1</span> to <span class="token number">16384</span><span class="token punctuation">)</span>? <span class="token number">4000</span>		<span class="token comment">### 这里输入要从原有的节点中迁移多少槽给30007</span>
What is the receiving <span class="token function">node</span> ID? df0190853a53d8e078205d0e2fa56046f20362a7  <span class="token comment">### 这里输入 30007 的 nodeid</span>
Please enter all the <span class="token builtin class-name">source</span> <span class="token function">node</span> IDs.
  Type <span class="token string">&#39;all&#39;</span> to use all the nodes as <span class="token builtin class-name">source</span> nodes <span class="token keyword">for</span> the <span class="token builtin class-name">hash</span> slots.
  Type <span class="token string">&#39;done&#39;</span> once you entered all the <span class="token builtin class-name">source</span> nodes IDs.
Source <span class="token function">node</span> <span class="token comment">#1: all  ### 这里输入 all， 表示从 30001、 30002、 30003 节点随机抽取</span>
 
<span class="token comment"># ......忽略其他</span>
Moving slot <span class="token number">2656</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2657</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2658</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2659</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2660</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2661</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2662</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2663</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2664</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2665</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Do you want to proceed with the proposed reshard plan <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>


$ redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-p</span> <span class="token number">30001</span>
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster slots <span class="token comment"># 查看集群槽位信息</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1332</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30007</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;df0190853a53d8e078205d0e2fa56046f20362a7&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30008</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;1d09d26fd755298709efe60278457eaa09cefc26&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5461</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6794</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30007</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;df0190853a53d8e078205d0e2fa56046f20362a7&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30008</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;1d09d26fd755298709efe60278457eaa09cefc26&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">10923</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">12255</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30007</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;df0190853a53d8e078205d0e2fa56046f20362a7&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30008</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;1d09d26fd755298709efe60278457eaa09cefc26&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">12256</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">16383</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30003</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;f5958382af41d4e1f5b0217c1413fe19f390b55f&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30004</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;1a324d828430f61be6eaca7eb2a90728dd5049de&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6795</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">10922</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30002</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;3da35c40c43b457a113b539259f17e7ed616d13d&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30006</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;dc0702625743c48c75ea935c87813c4060547cef&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1333</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5460</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30001</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;887397e6fefe8ad19ea7569e99f5eb8a803e3785&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30005</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;abec9f98f9c01208ba77346959bc35e8e274b6a3&quot;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>迁移完成之后发现： 30001、 30002、 30003 各迁移了一部分槽给 30007 。 部署视图变成：</p><figure><img src="`+d+`" alt="1726162400771" tabindex="0" loading="lazy"><figcaption>1726162400771</figcaption></figure><h4 id="移除某节点" tabindex="-1"><a class="header-anchor" href="#移除某节点" aria-hidden="true">#</a> 移除某节点</h4><p>使用 cluster forget {nodeId} 命令就可以把一个节点从集群中移除。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster forget df0190853a53d8e078205d0e2fa56046f20362a7
OK

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,78),k={href:"https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Redis%20%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e6%88%98/39%20%e5%ae%9e%e6%88%98%ef%bc%9aRedis%20%e9%9b%86%e7%be%a4%e6%a8%a1%e5%bc%8f%ef%bc%88%e4%b8%8a%ef%bc%89.md",target:"_blank",rel:"noopener noreferrer"};function v(f,g){const s=i("ExternalLinkIcon");return e(),t("div",null,[m,n("ul",null,[n("li",null,[n("a",k,[p("39 实战：Redis 集群模式（上）"),l(s)])])])])}const _=a(b,[["render",v],["__file","ch06-running-mode.html.vue"]]);export{_ as default};
