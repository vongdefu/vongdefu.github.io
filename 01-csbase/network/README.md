---
title: 计算机网络
dir:
  link: true
---

## 大纲

- 七层协议及每层的作用、五层协议、TCP/IP 协议，它们之间的迭代过程
- TCP/IP 协议
  - 应用层
    - URI VS URL
    - HTTP（超文本传输协议）
      - HTTP 报文格式、
      - 请求方法及其作用
      - 响应码
      - HTTP 迭代过程（1.0 -> 1.1 -> 2.0 -> HTTPS）
      - HTTPS 过程
      - 长链接与短链接
      - 跨域及其解决方案
      - 如何理解 HTTP 有状态和无状态？
      - 既然已经有了 HTTP，为什么还会有 RPC？
      - 既然有了 HTTP，为什么还会有 WebSocket？
    - DNS（地址解析协议）过程
    - Cookie 与 Session ，分布式会话
  - 传输层
    - TCP 报文格式
    - 可靠性保证手段
    - 粘包问题及解决方案、拆包问题及解决方案
    - TCP 洪泛滥问题及解决方案
    - 三次握手
      - 过程
      - 为什么不能是两次或四次？
      - 洪泛滥问题及其解决方案
    - 四次挥手
      - 过程
      - 为什么需要四次？
        - 单向通道问题
        - 服务端可能还有部分数据未接收完毕
    - TCP 和 UDP 区别
  - 网络层
    - IP 报文格式
      - 网络号、主机号、IP 地址、子网掩码、网关
    - 超网划分
    - 多网卡选择过程
    - IP 协议转发流程（MAC-端口映射表、路由表）
    - IPv4 VS IPv6
  - 网络接口层
    - 集线器
      - 作用：
    - 交换机
      - 作用：
    - 路由器
      - 作用：
    - 为什么有 IP 了还需要 MAC？
- 一次网络请求的过程
  - TCP/IP 四层协议上的一次网络请求过程
  - Linux 一次请求的过程
- CDN 原理
- 安全
  - 安全问题类型解决方案
    - HTTPS 过程
    - TCP 洪泛滥攻击
    - DDos 攻击、跨域请求攻击、XSS 攻击、SQL 注入攻击
- 补充
  - 什么是 RESTful API 架构以及如何理解这种架构？
  - 未出现 RESTful API 架构之前的应用层通信方式是怎么样的？
  - **RESTful API** vs **SOAP** vs **XML-RPC**

## 前言

::: tip 导学指引

首先要明白一个基本问题：计算机网络到底解决了什么问题。那么我们就先从现实社会中的从一个请求从开始到结束的整个过程来说。

主要包括两方面的内容：

1. 数据包的封装和解析；
2. 数据包在整个链路上的传输过程；

上面两个过程完成之后，一个请求就算是基本完成了。但是在这个过程中还有许多问题需要解决，然后我们就可以根据出现了什么问题，具体的解决方案是什么的顺序进行展开。

因此我们的逻辑树应该是这样的：

1. 一个请求从开始到结束的整个过程是怎样的？
2. 之后才进入理论部分：
   1. 什么是 OSI 七层模型、五层模型、TCP/IP 四层模型分别是什么，他们之间的发展过程是怎样的。
   2. 之后是按照 TCP/IP 四层模型分别展开。

:::

### 学习方法

1. 学习计算机网络，事实上就是学习各种各样的协议，以及最后使用各种协议了解整个网络请求到响应的过程。
2. 直接阅读 RFC 原版英文文档，其实很简单；配合 Wiki 一块；
3. 使用 相关工具 进行实验；

### 为什么要分层

1. 分层的意义在于： 让每一层都有自己的具体实现，又让每一层都有统一的实现标准。
2. Java 程序员的核心工作也是基于操作系统上层，写一些应用程序，这些应用程序在 OSI 模型中属于应用层的概念，本质上是对计算机资源的组合使用。比如，tomcat，就是组合使用了操作系统中的网络资源、CPU 资源、内存资源等。而操作系统是已经完成了对一些资源的操作的统一的对外的接口。比如说 Tomcat 要想在 Linux 平台上使用网络资源，本质上就是 tomcat 调用了操作系统对外提供的一系列的 api 接口。
3. 应用层多使用 HTTP 协议，所以应用层就要实现单独属于自己的 HTTP 协议的实现。协议的实现与协议本身的区别： 我在淘宝上买东西，我只需要完成挑选商品和付款操作即可，不需要关注淘宝到底使用什么快递给我运送货物；挑选商品和付款操作就是我与淘宝之间的协议，最后淘宝选择了顺丰帮我运送货物，那顺丰快递就是我和淘宝之间协议的具体实现。同样的，类比到应用层的实现上也是一样，协议的最终效果就是完成双方的通信，具体的实现方式就是由通信双方自行协商。

### 计算机网络的发展历程

![1720600203107](./image/1720600203107.png)

- 所谓 `通信`，就涉及到信息的发送方和信息的接收方，因此，对于发送方发送出去的消息是如何进行控制的（如加密、压缩、分组等控制手段），只要能够让接收方接收到的信息进行反向操作（解密、解压缩、合并分组等反向控制手段），那么就可以达到信息的“可靠”传递。至于接收方接收到信息后如何处理，则需要通信双方事先规定好信息的控制手段，这些信息的控制手段就被称为 `协议`。
- 计算机网络，就是解决信息在互联网上进行传递的一门学问，核心就是各种各样的协议。
- `协议`： 说白了，就是一组规则，代表着某个物体或要解决某个问题所遵循的标准；通信协议的制定只遵循一个标准，那就是“通信双方都认可”，这就意味着“是个人就可以制定协议”，但实际上前人制定的 TCP/IP 已经非常完善，我们在学习过程中只需要“站在巨人的肩膀”上即可。
- `OSI（Open System Interconnection， 开放系统互连参考模型）`是国际标准化组织（ISO）制定的一个用于计算机或通信系统间互联的标准体系。可以理解为一个“形而上”的标准，`中看不中用`。它严格规定了每一层所承担的任务，由上至下：
  - 应用层： 管理各种应用程序使用网络的规则，包括 HTTP、FTP、SMTP、POP3、DNS 等；
  - 表现层： 管理信息的语法语义以及它们之间的联系；
  - 会话层： 建立并管理会话；
  - 传输层： 控制数据分组及应用程序端口，协议内容有： TCP、UDP 等协议；
  - 网络层： 控制数据在网络上的传输过程，协议内容包括： IP、ARP、RARP 等协议；
  - 数据链路层： 规定 0/1 的编码、解码方式等；
  - 物理层： 规定各类网络设备的电气特性；
- 人们在实践过程中，发现上面三层（应用层、表现层、会话层）都可以由应用程序自行控制，因此就发展出了 `五层协议`，即把 OSI 中的应用层、表现层和会话层三层合并成一层——应用层。
- 随着硬件设备的发展，人们又发现在实际的使用过程中并不需要过多的关注 OSI 中数据链路层和物理层，再加上传输层（TCP 和 UDP 协议）以及网络层（IP、ARP、RARP 等协议）的发展，于是人们再次把 OSI 的数据链路层和物理层进行简化，就形成了现在的“事实标准”——`TCP/IP四层模型`，这个模型也是我们研究的 `重点`。
- 为便于理解，笔者把 TCP/IP 四层模型在现实中的实现过程对应到计算机各个组件上，如上图中的物理模型。

### TCP / IP 协议族

| 分层                                             | 常见协议                                                                                                                                       | 解决的问题                                 |
| :----------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------ |
| 4 应用层 application layer                       | HTTP、FTP、DNS （如 BGP 和 RIP 这样的路由协议，尽管由于各种各样的原因它们分别运行在 TCP 和 UDP 上，仍然可以将它们看作网络层的一部分）          | 解决的是应用程序层面的数据格式问题         |
| 3 传输层 transport layer                         | TCP、UDP、RTP、SCTP （如 OSPF 这样的路由协议，尽管运行在 IP 上也可以看作是网络层的一部分）                                                     | 解决的是应用程序怎么使用操作系统资源的问题 |
| 2 网络互连层 internet layer                      | 对于 TCP/IP 来说这是因特网协议（IP）（如 ICMP 和 IGMP 这样的必须协议尽管运行在 IP 上，也仍然可以看作是网络互连层的一部分；ARP 不运行在 IP 上） | 解决的是这些数据在网络中如何传输的问题     |
| 1 网络访问（链接）层 Network Access (link) layer | 例如以太网、Wi-Fi、MPLS 等。                                                                                                                   | 解决的是设备与设备之间的通信的问题         |

过程:

1. HTTP 解决使用何种协议、何种方法、包含什么数据内容等与应用程序相关的内容；并不关心连接的情况；
2. TCP 解决的是客户端主机上哪个应用程序与服务端主机哪个应用程序通信的问题；需要关心连接的情况；
3. IP 解决的是网络与网络之间的互相通信的问题；
4. MAC 解决的是设备与设备之间的相互通信问题；

## TCP/IP 四层模型

主要包括应用层、传输层、网络层和网络接口层。其中的协议包括： HTTP 、 TCP 和 UDP、 IP 协议。

- 应用层： 主要负责数据格式处理、会话控制等问题；例如，每个应用程序应该使用什么样的数据格式传输数据、在传输数据过程中需要保持哪些会话信息等；
- 传输层： 主要负责处理操作系统与多个应用程序之间的问题；例如，多个应用程序的端口分配问题、多个应用程序在数据传输过程中的数据分组问题、单个应用程序大数据量的数据分组问题、可靠性传输问题；
- 网络层： 主要负责通信双发与网络的问题；例如，传输层封装好的数据应该传送到哪个网络分区等；
- 网络接口层： 主要负责协调处理硬件之间不同端口的数据传输；例如，数据传到哪个路由器后，应该把数据发给哪个端口等；

## 一个请求的详细过程

chrome 地址栏中输入 www.baidu.com 的整个详细过程：

1. chrome 新开一个标签页，Windows 平台就会自动创建一个线程，并且分配好一个端口号，准备好一些系统资源；我们假设这个端口号为： chromePort ；
2. 浏览器输入 www.baidu.com ，按下回车，浏览器会依次查找： 浏览器的 dns 缓存 -> 操作系统 DNS 缓存 -> 路由器缓存 -> 网络服务商 DNS 缓存（ISP DNS），直到找到 对应的 IP（183.2.172.185） 和 端口号（443）；于是报文有了：

![1721382063747](./image/1721382063747.png)

但此时还没有找到 源 IP

3. 于是操作系统就去查本地路由表，发现 百度 IP 只对应到路由表中的第一行，于是找到出口，也就是找到了源 IP，此时报文变成：

![1721382208350](./image/1721382208350.png)

但此时还没有找到 源 MAC

4. 于是 ARP 协议去找 IP 与 MAC 的对应关系，找到为： 40-8d-5c-ff-a3-47 ，于是报文变成了：
5. 然后就有了 chrome 会自动拼接上一些方法和协议版本等信息，于是产生 HTTP 层面的报文
6. 即相当于在 Windows 平台上申请了一个端口号，假设这个端口号为 chromePort ，这就有了传输层的“源端口号”，又因为请求的是 https，默认的服务器端的端口号是“443”，这就有了；
7.

![1721381511345](./image/1721381511345.png)

浏览器缓存 → 系统缓存 → 路由器缓存 →ISP DNS 缓存 → 递归搜索

### todo

提纲

1. 实际的物理链路图，这里是说硬件之间的通信链路，先不深究内部原理。目的在于直观地展示网络请求过程。
2. 之后要对计算机有个基本了解，要知道一个应用程序在计算机上运行起来的基本原理是怎样的。
3. 之后以一个实际需求为例，以实现需求中遇到的问题为驱动，逐步展开进行说明。

#### 物理链路图

![image.png](./image/1700919209804.png)

> 简单说明一下。

#### 前置知识

> 应用程序在计算机上运行的大概原理。

#### 一个完整的请求过程

![](./image/1700921856486.png)

1. 以我在浏览器里面输入百度官网地址为例。首先要说的是，计算机中的很多内容都是从现实生活中提炼总结出来的，这个过程我们称为抽象，即计算机网络模型就是从现实生活中抽象出来的，那这个现实生活中的案例是什么呢？人们很容易想到，就是寄信的案例。寄信的第一步，那肯定是要写信吧，对应计算机中也是一样，那我要发送一条信息
2. 我的 PC 上有多个应用程序，如 chrome 浏览器、微信客户端、语雀客户端等等。

一台计算机上运行着很多应用程序，怎么区分每一个应用程序呢，端口出现。

浏览器使用 HTTP 报文格式生成了一个请求报文，报文里面表明了这个消息使用的是什么格式。

有了请求报文之后，浏览器就会调用 Linux 的 socket 接口，然后由 socket 封装 端口，这个报文包括应用程序的端口，以及服务器上应用程序的端口。【应用程序的端口是怎么获得的——应用程序自己向操作系统申请的】

之后，由网络接口层分装 IP 报文，IP 报文中包括几个问题：

1. 域名与 IP 之间的相互转化；DNS 协议；
2. 自己的 IP 是如何获取的；DHCP 协议；
3. 公网 IP 与局域网 IP 的相互转化；NAT 协议；
4. 如何获取 MAC 地址；ARP 协议；把请求 mac 地址的数据包广播给本网络中的所有主机，我的 ip 是 192.168.10.23，mac 是 a，我要找 192.168.10.96 的 mac；然后对应的主机以单播的方式相应对应的 mac 给到我。【这里有个问题，那就是如果我请求的 IP 地址不在本网络中，那么会怎么处理】
   1. 事实上，可以理解为，在获取 mac 地址的时候，内核会先查询自己本地缓存的映射表，然后根据本机 IP 和子网掩码，找到路由器所在的 ip，让 路由器进行广播，如果有应答就获取 mac，如果没有应答，那最终协议的 mac 地址就是路由器的地址。
   2. 下一步骤是路由器把报文中的目标 mac 置空，然后根据路由表再次找 mac；

到此为止，数据包算是差不多完了。

下面是传输过程；

应用程序到内核是通过调用操作系统接口完成的；
内核到网卡是通过调用硬件驱动完成的；

## 参考连接汇总

- [用大白话解释什么是 Socket](https://zhuanlan.zhihu.com/p/260139078)
- [javaDesign](https://github.com/idaSmilence/javaDesign)
- 《Java 面试小抄 V1.0.pdf》
- 《Java 面试小抄 V2.0.pdf》
- 《字节大佬总结的面试资料.pdf》
- [经典面试题：在浏览器地址栏输入一个 URL 后回车，背后发生了什么](https://cloud.tencent.com/developer/article/1793846)
- [25 张图，一万字，拆解 Linux 网络包发送过程](https://mp.weixin.qq.com/s/TpLuyYoLp3x5ODCTI7HQ4w)
- [HTTPS 详解一：附带最精美详尽的 HTTPS 原理图](https://segmentfault.com/a/1190000021494676?u_atoken=d6711e9e-dc2d-43f0-a819-4ab7836a9c2b&u_asession=015lll-xAhJhWi-_IJYFkWxdU4vFG9aCefjVuKte0BeMtJXoSG3DAFvbu70sMtfjp3X0KNBwm7Lovlpxjd_P_q4JsKWYrT3W_NKPr8w6oU7K9eow9p5QJkIGLilVG6S6oRkGMSrTOhD_XUpDR5CwHm22BkFo3NEHBv0PZUm6pbxQU&u_asig=05YU5dtK69lipJR4PlqM8ouSkUbdFOwfw--lli_thxngX4HLEN8GLe_rcYMYyiU7yxIZDugEmudCOb2Lu3dDX2faqb4QtpVf0wOhu8JLoI7FS2cGKbY0lvE7fflYhexLiCgLNPgl43Jb6jbn0v4g5KAXh4ixyOHD93GskhI9Hh9Yj9JS7q8ZD7Xtz2Ly-b0kmuyAKRFSVJkkdwVUnyHAIJzdxeBiXBBmd5cV0MDDXwULsqyMc_RM4SztNjunBdu-2XhQ3oUrcZv4kkkaTSIPALCO3h9VXwMyh6PgyDIVSG1W827G8fbWbXGj0TzqyuL0LS32TG907D-0gWFGobKr9p4upJq0IyO3xPyjU7aTwH-HcZ_tlfIran0r43ozchadDUmWspDxyAEEo4kbsryBKb9Q&u_aref=0334X4bWzSwmxDUJZibalNVn3sA%3D)
- [键入网址到网页显示，期间发生了什么？](https://xiaolincoding.com/network/1_base/what_happen_url.html#%E5%AD%A4%E5%8D%95%E5%B0%8F%E5%BC%9F-http)
- [硬核图解！30 张图带你搞懂！路由器，集线器，交换机，网桥，光猫有啥区别？](https://mp.weixin.qq.com/s/6eQ00Wzss61XUTO8xeL3iA)
- [RFC 2616](https://datatracker.ietf.org/doc/html/rfc2616)
- [rfc2616 中文翻译](http://files.blogjava.net/sunchaojin/http1.3.pdf)
- [rfc793](https://www.rfc-editor.org/rfc/rfc793.html)
- [RFC793 中文版](https://blog.csdn.net/m0_46500807/article/details/113899976)
- [传输控制协议](https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE)
- [面试小炒](https://www.javalearn.cn/#/doc/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%9D%A2%E8%AF%95%E9%A2%98)
- [图解网络](https://xiaolincoding.com/network/)
